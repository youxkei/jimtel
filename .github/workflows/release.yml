
{
    name: "Release",

    on: {
        push: {
            tags: ["v*.*.*"],
        },
    },

    env: {
        CARGO_TERM_COLOR: "always",
    },

    jobs: {
        build: {
            strategy: {
                matrix: {
                    os: ["ubuntu-latest", "windows-latest", "macOS-latest"],
                    rust: ["nightly"],
                },
            },

            runs-on: "${{ matrix.os }}",

            steps: [
                {
                    name: "Setup Rust",
                    uses: "hecrj/setup-rust-action@v1",
                    with: {
                        rust-version: "${{ matrix.rust }}",
                    },
                },
                {
                    name: "Checkout",
                    uses: "actions/checkout@v2",
                },
                {
                    name: "Install Dependencies",
                    if: "matrix.os == 'ubuntu-latest'",
                    run: "
                        sudo apt install -qq cmake libx11-dev libxcb-icccm4-dev libx11-xcb-dev libxcb-dri2-0-dev libxcursor-dev libfreetype6-dev libexpat1-dev libxmltok1-dev
                    ",
                },
                {
                    name: "Build for Linux",
                    if: "matrix.os == 'ubuntu-latest'",
                    run: "make jimtel_linux.tar.gz",
                },
                {
                    name: "Build for Windows",
                    if: "matrix.os == 'windows-latest'",
                    run: "make jimtel_windows.zip",
                },
                {
                    name: "Build for macOS",
                    if: "matrix.os == 'macOS-latest'",
                    run: "make jimtel_macos.zip",
                },
                {
                    name: "Release",
                    uses: "softprops/action-gh-release@v1",
                    with: {
                        files: "jimtel_*",
                    },
                    env: {
                        GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}",
                    }
                }
            ],
        },
    },
}
